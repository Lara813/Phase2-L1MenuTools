# Object Performance Tools
  
  The object performance tools allow the user to produce
  matching efficiency, turn-on curves, and scaling plots for
  the various L1 objects.
  The definition of each object to be tested is detailed in
  this [TWiki page](https://twiki.cern.ch/twiki/bin/view/CMS/PhaseIIL1TriggerMenuTools).

  A detailed description of each step, together with instructions on how to set up the
  configuration files for the cache and plotting steps, is given in
  [the Wiki pages](https://github.com/cms-l1-dpg/Phase2-L1MenuTools/wiki).

  The following presents the commands to be run to produce the standard set of validation
  plots (cf. [these slides](https://twiki.cern.ch/twiki/pub/CMS/PhaseIIL1TriggerMenuTools/Phase2Menu_validation123x-3.pdf)).

## Table of content

* [Caching the NTuple trees](#caching-the-ntuple-trees)
* [Efficiency and Scalings](#efficiency-and-scalings)
  * [Reference config files](#reference-config-files)

## Caching the NTuple trees

  **Note:** When running on lxplus, usually the cache files will already
  be present in the symliked directory included with the repo.

  In order to run the next steps, the object
  `TTrees` from the L1NTuples need to be cached
  as `awkward` arrays saved into `.parquet` files.
  This is done by running:

  ```
  cache_objects <path_to_config>
  ```

  An example for a caching config can be found at `configs/V29/caching.yaml`.
  The output of this step is saved to `cache`.
  This step needs to be run only once per configuration (unless changes in the input
  L1 ntuples occur) and the `.parquet` files generated by the code can be
  used for all the subsequent steps of the workflow, without having to open the
  `.root` files and load the objects every time the framework is run.

## Efficiency and Scalings
  To produce matching efficiencies, turn-on curves, and L1 scalings run

  ```
  object_performance <path_to_config>
  ```

  The production of the scalings is a prerequisite for the generation of
  offline rate plots as well as the rate table. It is possible to use
  wildcards (e.g. `*_trigger.yaml`) to run multiple configs in succession.

### Reference config files

  Default configuration files are contained in `configs` and should be used as
  templates for custom configurations.

  The points used for the calculation of the scalings correspond to the list of
  threshold cuts defined in
  [`scaling_thresholds`](https://github.com/cms-l1-dpg/Phase2-L1MenuTools/blob/main/configs/scaling_thresholds.yaml).

  The outputs will be written to the `outputs/<VERSION>` directory,
  where `<VERSION>` is the version of the ntuples used for the plots as specified
  in the `.yaml` config file (more details on the config file are given below).
  In the current version of the code, the plots will be saved in three folders under `outputs/<VERSION>`:

  * `distributions`: plots of the distributions (histograms) used to compute the efficiencies. For each efficiency curve plotted, these plots depict the distributions used for as numberator and denumerator in the computation of the efficiencies.

  * `turnons`: plots of the matching efficiencies and L1 turn-on efficiency curves.

  * `scalings`: plots of the scalings, i.e. position of the turnon point (often 95% location) as a function of different threshold cuts on L1 objects.
